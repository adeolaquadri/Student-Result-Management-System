<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Change Password</title>
    <link rel="page icon" type="icon" href="/fcahptib.png">
    <link rel="stylesheet" href="/style.css">
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="/jquery-3.7.1.min.js"></script>
    <script src="/index.js"></script>
    <style>
        .myform{
            margin: auto;
            width: 300px;
            background-color: #fff;
            padding: 20px;
            height: auto;
        }
        .myform input{
            padding: 5px;
            width: 250px;
            outline: none;
            border: 1px solid black;
            font-size: 16px;
            font-style: normal;
            font-family: serif;
        }
        .myform label{
            font-size: 16px;
            font-family: calibri;
            font-weight: bold;
        }
        .myform button{
            outline: none;
            border: none;
            width: 100px;
            height: 40px;
            color: #fff;
            cursor: pointer;
            font-size: 16px;
            font-family: lucida sans regular;
            background-color: rgb(167, 50, 50);
            text-transform: lowercase;
        }
        .sidebar a{
            text-decoration: none;
        }
    </style>
</head>
<body style="background-color: gainsboro;">
    <div class="header">
        <img src="fcahptib.png" alt="" height="50">
        <a href="javascript:void(0);" class="icon" onclick="myFunction()">
            <i class="fa fa-bars" style="font-size: 20px; color: #fff;
             align-self: center;"></i>
          </a>  
        </div>
        <div class="sidebar" id="sideBar" style="width: 180px;">
            <p style="font-family: calibri; font-size: 16px; text-align: center;"><%=fullname%></p><br>

            <p style="font-family: calibri; font-size: 16px; text-align: center;
        color: rgb(71, 71, 71); display: block;">
        <i class="fa fa-fw fa-map-marker" style="font-size: 16px;"></i><%=department%></p><br><br>
    
                <a href="/dashboard" class="active"><i class="fa fa-fw fa-dashboard"></i>Dashboard</a><br><br><br>
                <a href="/profile" id="profile"><i class="fa fa-fw fa-user"></i>Profile</a><br><br><br>
                <a href="/course_registration"><i class="fa fa-fw fa-book"></i>Course Registration</a><br><br><br>
                <a href="RePrint_Course_Form"><i class="fa fa-fw fa-book"></i>Reprint course form</a><br><br><br>
                <a href="/result"><i class="fa fa-fw fa-table"></i>My Result</a><br><br><br>
                <a href="/change_password"><i class="fa fa-fw fa-lock"></i>Change Password</a><br><br><br>
                <a href="/logout" id="logout"><i class="fa fa-fw fa-sign-out"></i>Logout</a><br><br><br>
        </div>
    <div class="main-content" id="mainContent">
        <div class="myform">
            <div id="error" style="<%=style%>"><%=message%></div>
            <label for="">Old Password:</label><br>
            <input type="password" name="oldpassword" id="oldpass" required/><br><br>

            <label for="">New Password:</label><br>
            <input type="password" name="newpassword" id="newpass" required/><br><br>

            <label for="">Confirm Password:</label><br>
            <input type="password" name="confirmpassword" id="conpass" required/><br><br>

            <button id="updatebtn">Change</button>
        </div>
        <footer>
            <p style="font-size: 14px; text-align: center;
            font-style: normal; font-family: sans-serif; color: gray;">
             <span id="cr"></span> &copy;FCAHPTIB.</p>
            <p style="font-size: 14px; text-align: center;
            font-style: normal; font-family: sans-serif; color: gray;">Designed by Adeola Quadri. A</p>
            <p style="font-size: 14px; text-align: center;
            font-style: normal; font-family: sans-serif; color: gray;">Supervised by Dr. Mrs Olarenwaju O T.</p>
         </footer>
        </div>
        
    <script>
        document.querySelector('#logout').addEventListener('click', (e)=>{
   if(confirm('Are sure you want to logout?') == true){
       fetch('/logout',{
       method: 'get'})
   }else{
       e.preventDefault()
   }
   
})
let date = new Date()
document.getElementById('cr').innerHTML = date.getFullYear();
function myFunction() {
var x = document.getElementById("sideBar");
if (x.style.display === "block") {
x.style.display = "none";
document.getElementById("mainContent").style.marginLeft = "0";
} else {
x.style.display = "block";
document.getElementById("mainContent").style.marginLeft = "180px";

}
}

const errorMessage = document.getElementById('error');
if(errorMessage.innerHTML !== ''){
    setTimeout(function(){
    errorMessage.style.display = 'none';
},3000)}

document.querySelector('#updatebtn').addEventListener('click', ()=>{   
const oldpassword = document.getElementById("oldpass").value;
const newpassword = document.getElementById("newpass").value;
const confirmpassword = document.getElementById("conpass").value;

const data = {
  oldpassword: oldpassword,
  newpassword: newpassword,
  confirmpassword: confirmpassword
};
updatePassword(data)
});

function updatePassword(data){
fetch('/new_password', {
  method: 'PUT',
  headers:{
    'Content-Type': 'application/json',
  },
  body:JSON.stringify(data)
})
.then(response => {response.json();
  if(response.status === 200){
    alert(`Password updated successfully!`);
  }else if(response.status === 401){
    alert('Incorrect Password!');
  }else if(response.status === 403){
    alert('Passwords do not match!');
  }else{
    alert('Error updating password...');
  }
  })
}
    </script>
</body>
</html>